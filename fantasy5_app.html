<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CA Fantasy 5</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fantasy 5">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh;padding:12px;
            -webkit-overflow-scrolling:touch;
            -webkit-tap-highlight-color:transparent;
        }
        .container{max-width:1000px;margin:0 auto;background:#fff;border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,.3);padding:24px}
        h1{color:#2d3748;text-align:center;font-size:clamp(1.6em,5vw,2.5em);margin-bottom:4px}
        .subtitle{text-align:center;color:#718096;margin-bottom:20px;font-size:.95em}

        /* STATUS BAR */
        #statusBar{
            display:flex;align-items:center;justify-content:space-between;gap:10px;
            padding:10px 14px;border-radius:10px;margin-bottom:18px;font-size:.85em;
            background:#e2e8f0;color:#4a5568;
        }
        #statusBar.checking{background:#fef3c7;color:#92400e}
        #statusBar.success{background:#d1fae5;color:#065f46}
        #statusBar.error{background:#fee2e2;color:#991b1b}
        #statusBar.offline{background:#e2e8f0;color:#4a5568}
        .refresh-btn{
            background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;
            border:none;padding:6px 14px;border-radius:8px;font-size:.85em;
            cursor:pointer;white-space:nowrap;flex-shrink:0;
        }
        .refresh-btn:active{opacity:.75}
        .spin{animation:spin 1.2s linear infinite;display:inline-block}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* STATS CARDS */
        .stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:24px}
        @media(min-width:600px){.stats-grid{grid-template-columns:repeat(4,1fr)}}
        .stat-card{background:linear-gradient(135deg,#667eea,#764ba2);padding:16px;border-radius:12px;color:#fff}
        .stat-label{font-size:.78em;opacity:.9;margin-bottom:4px}
        .stat-value{font-size:1.6em;font-weight:700;line-height:1.1}

        /* SECTIONS */
        .section{margin-bottom:28px;background:#f7fafc;padding:20px;border-radius:12px}
        h2{color:#2d3748;margin-bottom:14px;font-size:clamp(1.1em,4vw,1.5em);border-bottom:3px solid #667eea;padding-bottom:8px}
        .chart-container{position:relative;height:260px}
        @media(min-width:600px){.chart-container{height:360px}}

        /* HOT/COLD GRID */
        .number-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(62px,1fr));gap:8px;margin-top:14px}
        .num-cell{text-align:center;padding:10px 6px;border-radius:9px;font-weight:700;font-size:.85em;transition:transform .15s;cursor:default}
        .num-cell:hover{transform:scale(1.06)}
        .hot{background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff}
        .warm{background:linear-gradient(135deg,#ffecd2,#fcb69f);color:#2d3748}
        .cool{background:linear-gradient(135deg,#a8edea,#fed6e3);color:#2d3748}
        .cold{background:linear-gradient(135deg,#d299c2,#fef9d7);color:#2d3748}
        .num-cell .n{font-size:1.25em}
        .num-cell .c{font-size:.72em;opacity:.85}

        /* INSIGHT BOXES */
        .insight{background:#fff;border-left:4px solid #667eea;padding:12px 16px;margin:12px 0;border-radius:5px;box-shadow:0 2px 8px rgba(0,0,0,.07)}
        .insight-title{font-weight:700;color:#667eea;margin-bottom:4px;font-size:.9em}
        .insight-body{font-size:.9em;line-height:1.6}

        /* TABLES */
        .tbl{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden;font-size:.82em;margin-top:14px}
        .tbl th{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:10px 12px;text-align:left}
        .tbl td{padding:9px 12px;border-bottom:1px solid #e2e8f0}
        .tbl tr:hover td{background:#f0f4ff}
        .hi{background:#fef3e2}

        .legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;font-size:.8em}
        .legend-item{display:flex;align-items:center;gap:5px}
        .legend-dot{width:14px;height:14px;border-radius:3px}
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ° CA Fantasy 5</h1>
    <div class="subtitle" id="subtitleDate">Latest 100 Draws</div>

    <div id="statusBar" class="checking">
        <span id="statusText"><span class="spin">âŸ³</span> Checking for latest dataâ€¦</span>
        <button class="refresh-btn" onclick="startUpdate()">Refresh</button>
    </div>

    <div id="app"></div>
</div>

<script>
// â”€â”€â”€ DATA STORE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STORAGE_KEY   = 'f5_draws_v2';
const UPDATED_KEY   = 'f5_updated_v2';
const TARGET        = 100;

let draws = [];
let chartInst = null;

// â”€â”€â”€ BUILT-IN SEED DATA (latest 100 draws as of 2026-02-07) â”€â”€â”€â”€â”€â”€â”€â”€
const SEED_DRAWS = [
    ["2026-02-07",[8,12,15,24,34]],["2026-02-06",[5,11,26,28,39]],
    ["2026-02-05",[8,26,28,32,38]],["2026-02-04",[9,11,25,26,29]],
    ["2026-02-03",[5,6,13,15,23]], ["2026-02-02",[1,8,23,24,36]],
    ["2026-02-01",[6,12,19,22,25]],["2026-01-31",[2,14,18,20,35]],
    ["2026-01-30",[9,13,18,24,28]],["2026-01-29",[2,4,8,17,21]],
    ["2026-01-28",[5,6,13,27,32]], ["2026-01-27",[1,4,22,33,39]],
    ["2026-01-26",[1,2,5,7,20]],  ["2026-01-25",[1,14,19,27,37]],
    ["2026-01-24",[15,18,25,33,35]],["2026-01-23",[11,14,15,20,36]],
    ["2026-01-22",[6,8,11,27,28]],["2026-01-21",[13,14,18,26,32]],
    ["2026-01-20",[7,8,13,22,28]],["2026-01-19",[11,19,22,27,30]],
    ["2026-01-18",[16,18,19,31,37]],["2026-01-17",[8,18,28,33,39]],
    ["2026-01-16",[3,8,16,31,33]], ["2026-01-15",[6,18,28,32,36]],
    ["2026-01-14",[2,9,12,25,39]],["2026-01-13",[4,9,25,27,35]],
    ["2026-01-12",[13,18,27,28,35]],["2026-01-11",[7,16,17,19,35]],
    ["2026-01-10",[12,13,15,24,34]],["2026-01-09",[23,25,28,29,35]],
    ["2026-01-08",[2,15,19,24,36]],["2026-01-07",[2,3,9,11,31]],
    ["2026-01-06",[1,10,28,31,39]],["2026-01-05",[5,9,15,21,24]],
    ["2026-01-04",[9,19,20,26,32]],["2026-01-03",[14,17,18,19,34]],
    ["2026-01-02",[3,13,22,31,38]],["2026-01-01",[13,14,24,25,35]],
    ["2025-12-31",[1,3,9,11,21]], ["2025-12-30",[10,12,22,28,37]],
    ["2025-12-29",[1,8,13,17,20]],["2025-12-28",[1,21,22,33,35]],
    ["2025-12-27",[8,9,20,26,36]],["2025-12-26",[2,6,7,8,35]],
    ["2025-12-25",[5,17,20,29,38]],["2025-12-24",[7,11,18,28,30]],
    ["2025-12-23",[5,14,15,19,26]],["2025-12-22",[1,14,16,18,19]],
    ["2025-12-21",[11,28,29,32,37]],["2025-12-20",[3,10,14,26,31]],
    ["2025-12-19",[8,18,23,28,38]],["2025-12-18",[7,12,13,21,32]],
    ["2025-12-17",[3,9,19,26,31]],["2025-12-16",[6,15,16,22,31]],
    ["2025-12-15",[9,17,22,26,36]],["2025-12-14",[6,16,23,31,32]],
    ["2025-12-13",[2,3,22,24,32]],["2025-12-12",[16,18,27,32,38]],
    ["2025-12-11",[7,13,23,26,30]],["2025-12-10",[1,2,5,10,17]],
    ["2025-12-09",[10,15,16,20,33]],["2025-12-08",[7,31,33,35,38]],
    ["2025-12-07",[11,13,14,19,39]],["2025-12-06",[9,11,12,13,34]],
    ["2025-12-05",[9,10,16,27,36]],["2025-12-04",[16,21,30,33,34]],
    ["2025-12-03",[6,7,28,29,32]],["2025-12-02",[6,16,18,20,33]],
    ["2025-12-01",[1,2,20,30,38]],["2025-11-30",[2,5,8,24,33]],
    ["2025-11-29",[2,10,27,28,34]],["2025-11-28",[13,14,21,23,32]],
    ["2025-11-27",[10,24,28,31,37]],["2025-11-26",[2,3,21,25,27]],
    ["2025-11-25",[3,5,7,18,24]],["2025-11-24",[5,17,20,36,39]],
    ["2025-11-23",[3,16,21,35,38]],["2025-11-22",[9,11,21,31,35]],
    ["2025-11-21",[10,11,17,28,33]],["2025-11-20",[8,12,24,36,39]],
    ["2025-11-19",[1,7,9,24,27]], ["2025-11-18",[2,3,6,12,39]],
    ["2025-11-17",[1,5,7,10,11]],["2025-11-16",[3,6,17,20,37]],
    ["2025-11-15",[4,9,13,23,35]],["2025-11-14",[4,13,24,32,37]],
    ["2025-11-13",[6,14,16,25,35]],["2025-11-12",[1,13,23,29,35]],
    ["2025-11-11",[3,5,8,11,28]],["2025-11-10",[6,15,29,31,37]],
    ["2025-11-09",[5,15,21,22,24]],["2025-11-08",[6,10,13,14,19]],
    ["2025-11-07",[9,17,31,37,38]],["2025-11-06",[5,6,11,15,38]],
    ["2025-11-05",[11,14,24,25,36]],["2025-11-04",[8,15,18,23,24]],
    ["2025-11-03",[7,9,20,27,36]],["2025-11-02",[4,11,13,33,39]],
    ["2025-11-01",[1,3,11,13,32]]
];

// â”€â”€â”€ CORS PROXY POOL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// We try several proxies in sequence until one works.
// Target: lotteryextreme.com â€” text-based, easy to parse.
const TARGET_URL = 'https://www.lotteryextreme.com/california/fantasy5-results';

const PROXIES = [
    url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
    url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
    url => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
];

async function fetchWithProxy(targetUrl) {
    for (const makeProxy of PROXIES) {
        const proxyUrl = makeProxy(targetUrl);
        try {
            const res = await fetch(proxyUrl, { signal: AbortSignal.timeout(12000) });
            if (!res.ok) continue;
            const text = await res.text();
            if (text.length > 500) return text;
        } catch (e) {
            // try next proxy
        }
    }
    return null;
}

// â”€â”€â”€ PARSE HTML FROM lotteryextreme.com â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseDrawsFromHTML(html) {
    // Extract date patterns like (MM/DD/YYYY) and numbers 1-39
    const results = [];

    // Match date blocks
    const dateRe = /(\d{1,2})\/(\d{2})\/(\d{4})/g;
    const numBlockRe = /<li[^>]*>\s*(\d{1,2})\s*<\/li>/g;

    // Split page around date occurrences for context
    const segments = html.split(/(?=\d{2}\/\d{2}\/\d{4})/);

    for (const seg of segments) {
        const dateMatch = seg.match(/^(\d{2})\/(\d{2})\/(\d{4})/);
        if (!dateMatch) continue;

        const [, mm, dd, yyyy] = dateMatch;
        const date = `${yyyy}-${mm}-${dd}`;
        if (parseInt(yyyy) < 2020) continue;

        // Grab numbers in <li> tags within next ~400 chars
        const chunk = seg.slice(0, 400);
        const nums = [];
        let m;
        const re = /<li[^>]*>\s*(\d{1,2})\s*<\/li>/g;
        while ((m = re.exec(chunk)) !== null) {
            const n = parseInt(m[1]);
            if (n >= 1 && n <= 39) nums.push(n);
        }
        if (nums.length === 5) {
            results.push([date, nums.sort((a,b)=>a-b)]);
        }
    }

    return results;
}

// â”€â”€â”€ MERGE & DEDUPLICATE DRAWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Takes newDraws (from web), merges with existing stored draws,
// deduplicates by date, keeps latest TARGET draws.
function mergeDraws(existing, incoming) {
    const map = new Map();
    // Existing goes in first
    for (const d of existing) map.set(d[0], d);
    // Incoming overrides/adds
    for (const d of incoming) map.set(d[0], d);

    return [...map.values()]
        .sort((a, b) => b[0].localeCompare(a[0]))   // newest first
        .slice(0, TARGET);
}

// â”€â”€â”€ STATUS UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setStatus(type, html) {
    const bar = document.getElementById('statusBar');
    const txt = document.getElementById('statusText');
    bar.className = type;
    txt.innerHTML = html;
}

// â”€â”€â”€ MAIN UPDATE FLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startUpdate() {
    setStatus('checking', '<span class="spin">âŸ³</span> Fetching latest drawsâ€¦');

    try {
        const html = await fetchWithProxy(TARGET_URL);

        if (!html) throw new Error('All proxies failed');

        const fetched = parseDrawsFromHTML(html);

        if (fetched.length < 10) throw new Error(`Only parsed ${fetched.length} draws`);

        // Merge with stored data
        const stored = loadStored() || SEED_DRAWS;
        draws = mergeDraws(stored, fetched);

        save(draws);

        const newest = draws[0][0];
        const oldest = draws[draws.length - 1][0];
        setStatus('success', `âœ“ Up to date Â· ${draws.length} draws Â· Latest: ${newest}`);
        document.getElementById('subtitleDate').textContent =
            `${draws.length} Draws Â· ${oldest} â†’ ${newest}`;

        renderApp();

        setTimeout(() => setStatus('offline',
            `Last updated: ${new Date().toLocaleString()} Â· Tap Refresh to check again`), 4000);

    } catch (err) {
        console.warn('Update failed:', err.message);

        // Fall back: try localStorage, then seed
        const stored = loadStored();
        if (stored && stored.length > 0) {
            draws = stored;
            const ts = localStorage.getItem(UPDATED_KEY);
            setStatus('error', `âš  Offline Â· Showing cached data Â· Last updated: ${ts ? new Date(ts).toLocaleDateString() : 'unknown'}`);
        } else {
            draws = SEED_DRAWS.slice(0, TARGET);
            setStatus('error', 'âš  Offline Â· Showing built-in data Â· Tap Refresh when online');
        }

        renderApp();
    }
}

function save(d) {
    try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(d));
        localStorage.setItem(UPDATED_KEY, new Date().toISOString());
    } catch(e) {}
}

function loadStored() {
    try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) && parsed.length > 0 ? parsed : null;
    } catch(e) { return null; }
}

// â”€â”€â”€ ANALYTICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function analyse(draws) {
    const freq = {}, appearances = {};
    for (let i = 1; i <= 39; i++) { freq[i] = 0; appearances[i] = []; }

    draws.forEach(([, nums], idx) => {
        nums.forEach(n => { freq[n]++; appearances[n].push(idx); });
    });

    // Pairs
    const pairs = {};
    draws.forEach(([, nums]) => {
        for (let i = 0; i < nums.length; i++)
            for (let j = i+1; j < nums.length; j++) {
                const k = [nums[i],nums[j]].sort((a,b)=>a-b).join('-');
                pairs[k] = (pairs[k]||0)+1;
            }
    });

    // Triplets
    const triplets = {};
    draws.forEach(([, nums]) => {
        for (let i=0;i<nums.length;i++)
          for (let j=i+1;j<nums.length;j++)
            for (let k=j+1;k<nums.length;k++) {
                const key = [nums[i],nums[j],nums[k]].sort((a,b)=>a-b).join('-');
                triplets[key] = (triplets[key]||0)+1;
            }
    });

    const sortedFreq = Object.entries(freq).sort((a,b)=>b[1]-a[1]);
    const avgSum = draws.reduce((s,[,n])=>s+n.reduce((a,b)=>a+b,0),0)/draws.length;

    // Gap data sorted by avg gap asc
    const gapData = [];
    for (let num=1;num<=39;num++) {
        const app = appearances[num];
        let avgGap = null;
        if (app.length > 1) {
            let tot = 0;
            for (let i=1;i<app.length;i++) tot += app[i]-app[i-1];
            avgGap = tot/(app.length-1);
        }
        const lastIdx = app.length > 0 ? app[app.length-1] : -1;
        gapData.push({ num, freq:freq[num], avgGap, lastDate: lastIdx>=0?draws[lastIdx][0]:'â€”', drawsAgo: lastIdx>=0?-lastIdx:draws.length });
    }
    gapData.sort((a,b)=>{
        if (a.avgGap===null && b.avgGap===null) return 0;
        if (a.avgGap===null) return 1;
        if (b.avgGap===null) return -1;
        return a.avgGap - b.avgGap;
    });

    return { freq, sortedFreq, avgSum, pairs, triplets, gapData };
}

// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderApp() {
    if (!draws.length) return;
    const { freq, sortedFreq, avgSum, pairs, triplets, gapData } = analyse(draws);

    const topPairs    = Object.entries(pairs).sort((a,b)=>b[1]-a[1]).slice(0,10);
    const topTriplets = Object.entries(triplets).sort((a,b)=>b[1]-a[1]).slice(0,8);

    document.getElementById('app').innerHTML = `
        <div class="stats-grid">
          <div class="stat-card"><div class="stat-label">Draws Analyzed</div><div class="stat-value">${draws.length}</div></div>
          <div class="stat-card"><div class="stat-label">Hottest Number</div><div class="stat-value">${sortedFreq[0][0]} <span style="font-size:.6em">${sortedFreq[0][1]}Ã—</span></div></div>
          <div class="stat-card"><div class="stat-label">Coldest Number</div><div class="stat-value">${sortedFreq[sortedFreq.length-1][0]} <span style="font-size:.6em">${sortedFreq[sortedFreq.length-1][1]}Ã—</span></div></div>
          <div class="stat-card"><div class="stat-label">Avg Sum</div><div class="stat-value">${avgSum.toFixed(1)}</div></div>
        </div>

        <div class="section">
          <h2>ğŸ“Š Number Frequency</h2>
          <div class="chart-container"><canvas id="freqChart"></canvas></div>
        </div>

        <div class="section">
          <h2>ğŸ”¥ Hot & Cold Numbers</h2>
          <div class="legend">
            <div class="legend-item"><div class="legend-dot hot"></div>Top 10 (hottest)</div>
            <div class="legend-item"><div class="legend-dot warm"></div>11â€“20</div>
            <div class="legend-item"><div class="legend-dot cool"></div>21â€“30</div>
            <div class="legend-item"><div class="legend-dot cold"></div>Bottom 9 (coldest)</div>
          </div>
          <div class="number-grid" id="hotCold"></div>
        </div>

        <div class="section">
          <h2>ğŸ”¢ Combination Patterns</h2>
          <div class="insight">
            <div class="insight-title">ğŸ” Most Common Pairs</div>
            <div class="insight-body">${topPairs.map(([p,c])=>`<strong>${p}</strong> â€” appeared ${c} times`).join('<br>')}</div>
          </div>
          <div class="insight">
            <div class="insight-title">ğŸ¯ Most Common Triplets</div>
            <div class="insight-body">${topTriplets.map(([t,c])=>`<strong>${t}</strong> â€” appeared ${c} times`).join('<br>')}</div>
          </div>
        </div>

        <div class="section">
          <h2>ğŸ“‹ Recent Draw History</h2>
          <table class="tbl">
            <thead><tr><th>Date</th><th>Numbers</th><th>Sum</th></tr></thead>
            <tbody>
              ${draws.slice(0,25).map(([d,n])=>`<tr><td>${d}</td><td><strong>${n.join(', ')}</strong></td><td>${n.reduce((a,b)=>a+b,0)}</td></tr>`).join('')}
            </tbody>
          </table>
        </div>

        <div class="section">
          <h2>ğŸ”„ Reoccurrence Analysis</h2>
          <div class="insight" style="margin-bottom:0">
            <div class="insight-title">Gap Analysis â€” sorted by avg gap (shortest first)</div>
            <div class="insight-body">Numbers that reappear most regularly sit at the top. Highlighted rows = top 10 shortest gaps.</div>
          </div>
          <table class="tbl">
            <thead><tr><th>#</th><th>Appearances</th><th>Avg Gap</th><th>Last Seen</th><th>Draws Ago</th></tr></thead>
            <tbody>
              ${gapData.map((d,i)=>`<tr class="${i<10&&d.avgGap!==null?'hi':''}">
                <td><strong>${d.num}</strong></td>
                <td>${d.freq}</td>
                <td>${d.avgGap!==null?d.avgGap.toFixed(1)+' draws':'N/A'}</td>
                <td>${d.lastDate}</td>
                <td>${d.drawsAgo} ago</td>
              </tr>`).join('')}
            </tbody>
          </table>
        </div>

        <div class="section">
          <h2>ğŸ’¡ Key Insights</h2>
          <div class="insight"><div class="insight-title">ğŸ’¡</div><div class="insight-body">Average sum of winning numbers is <strong>${avgSum.toFixed(1)}</strong> (theoretical average for random selection â‰ˆ 100)</div></div>
          <div class="insight"><div class="insight-title">ğŸ”¥ Hottest 5</div><div class="insight-body">${sortedFreq.slice(0,5).map(([n,c])=>`<strong>${n}</strong> (${c}Ã—)`).join(' Â· ')}</div></div>
          <div class="insight"><div class="insight-title">ğŸ§Š Coldest 5</div><div class="insight-body">${sortedFreq.slice(-5).map(([n,c])=>`<strong>${n}</strong> (${c}Ã—)`).join(' Â· ')}</div></div>
          <div class="insight"><div class="insight-title">ğŸ”¢ Shortest reoccurrence gaps</div><div class="insight-body">${gapData.filter(d=>d.avgGap!==null).slice(0,5).map(d=>`<strong>${d.num}</strong> (avg ${d.avgGap.toFixed(1)} draws)`).join(' Â· ')}</div></div>
          <div class="insight"><div class="insight-title">ğŸ† Most common pair</div><div class="insight-body"><strong>${topPairs[0][0]}</strong> appeared ${topPairs[0][1]} times</div></div>
        </div>
    `;

    // Chart
    const ctx = document.getElementById('freqChart').getContext('2d');
    if (chartInst) chartInst.destroy();
    chartInst = new Chart(ctx, {
        type:'bar',
        data:{
            labels: Object.keys(freq),
            datasets:[{
                label:'Times Drawn',
                data: Object.values(freq),
                backgroundColor:'rgba(102,126,234,.8)',
                borderColor:'rgba(102,126,234,1)',
                borderWidth:1
            }]
        },
        options:{
            responsive:true, maintainAspectRatio:false,
            plugins:{ legend:{ display:false }, title:{ display:true, text:`Frequency across ${draws.length} draws` } },
            scales:{
                y:{ beginAtZero:true, title:{display:true,text:'Times Drawn'} },
                x:{ title:{display:true,text:'Number (1â€“39)'} }
            }
        }
    });

    // Hot/cold grid
    const grid = document.getElementById('hotCold');
    sortedByFreq(freq).forEach(([num, cnt], idx) => {
        const div = document.createElement('div');
        div.className = 'num-cell ' + (idx<10?'hot':idx<20?'warm':idx<30?'cool':'cold');
        div.innerHTML = `<div class="n">${num}</div><div class="c">${cnt}Ã—</div>`;
        grid.appendChild(div);
    });
}

function sortedByFreq(freq) {
    return Object.entries(freq).sort((a,b)=>b[1]-a[1]);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function init() {
    // Show cached/seed data immediately so UI appears fast
    const stored = loadStored();
    draws = stored && stored.length > 0 ? stored : SEED_DRAWS.slice(0, TARGET);
    renderApp();

    const ts = localStorage.getItem(UPDATED_KEY);
    if (ts) {
        const age = Date.now() - new Date(ts).getTime();
        const hrsOld = age / 36e5;
        document.getElementById('subtitleDate').textContent =
            `${draws.length} Draws Â· Last updated ${hrsOld < 1 ? 'recently' : Math.round(hrsOld) + 'h ago'}`;
    }

    // Then try to fetch fresh data
    startUpdate();
})();

// â”€â”€â”€ PULL-TO-REFRESH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let startY = 0;
window.addEventListener('touchstart', e => { if(window.scrollY===0) startY=e.touches[0].pageY; });
window.addEventListener('touchmove',  e => { if(window.scrollY===0 && e.touches[0].pageY - startY > 80) { startY=0; startUpdate(); } });
</script>
</body>
</html>